How-to install Neubot below Linux and other Unices
==================================================

This document is intended for people running Unix-like operatings systems
(OSs) for which a package is not available (as well as for people
interested in experimenting with Neubot.)  We provide packages for the
following operating systems

* Ubuntu 9.10, 10.04

So, if you have installed one of the above, you probably might want to
give a look at the following web pages

* http://www.neubot.org:8080/
* http://nexa.polito.it/neubot

That said, this document explains how to run neubot in-place, e.g.
from the sources archive, and covers the topic of installing it manually
(possibily in order to prepare a package for your Linux distribution.)

Dependencies
------------

To run Neubot you need to have the complete Python 2.6 distribution
installed.  In other words, the command::

  python2.6 -V

Should return ``Python 2.6.X`` where ``X`` might vary depending on
your OS.  If that is not the case, you should take the proper steps in
order to install Python 2.6 on your distro.

We known that Python 2.6 is available for the following Unix-like
operating systems

* LinuxMint 7
* MacOsX 10.6 "Snow Leopard"
* OpenBSD 4.7
* Ubuntu 9.10, 10.04

Run Neubot in-place
-------------------

To run Neubot in-place from the sources directory, type::

  ./bin/unix/neubot -I.

The magic lies in the ``-I.`` command line switch, that instructs the
startup procedure to search the rest of the program in the current
working directory (rather than in ``/usr/local/share``.)

Invoked this way, neubot will run in automatic mode, e.g. it connects
periodically to the master server retrieving the list of tests to be
performed and checking for updates.  You can interrupt it with ``Ctrl-C``
at any time.

To find out more options, try the following commands::

  ./bin/unix/neubot -I. --help
  ./bin/unix/neubot -I. help


Install Neubot
--------------

The vanilla command to install Neubot, to be run as root, is::

  make install

It will install the neubot command in ``$PREFIX/bin`` and the rest of
the program in ``$PREFIX/share/neubot``, where, by default, ``PREFIX``
is ``/usr/local``.  By modifying ``PREFIX``, you can adjust the actual
location where Neubot is installed.  So, for example, to install below
``/opt``, become root and then type something like::

  make install PREFIX=/opt

Run Neubot automatically
------------------------

You need to create the ``_neubot`` user and group, because Neubot will
refuse to run as the ``root`` user.  To do that, as ``root``, type::

  groupadd _neubot
  useradd -d/ -g_neubot -s/bin/false _neubot

Now (assuming that you have installed Neubot below ``/opt``, as shown
in the above example) add near the bottom of ``/etc/rc.local`` the
following line::

  test -x /opt/bin/neubot && /opt/bin/neubot -bq

Finally, if you don't want to reboot your machine, start Neubot immediatly
with::

  /opt/bin/neubot -bq

Invoked that way, it will detach from the shell, running in background,
logging messages through ``syslog(3)``.  The actual log file employed
depends on your operating system, however, you can get a list of all the
files containing the ``neubot`` word running the following command as
``root``::

  grep neubot /var/log/*|awk -F: '{print $1}'|sort|uniq

Once you have guessed the name of the relevant file, you can ``grep``
to read just the Neubot-related messages, e.g. with Ubuntu::

  grep neubot /var/log/syslog|less

Uninstall Neubot
----------------

Assuming that you have installed Neubot below ``/opt``, as show by the
above example, you can take the following steps in order to uninstall it:

1. Become ``root``.

2. Kill all the running Neubots::

     kill `ps aux|grep neubot|grep -v grep|awk '{print $2}'`

3. Remove the neubot command::

     rm /opt/bin/neubot

4. Remove the rest of the program::

     rm -rf /opt/share/neubot/*
     rmdir /opt/share/neubot

In addition, if you amended your system to invoke Neubot at startup,
perform the following steps:

5. Remove the following line from ``/etc/rc.local``::

     test -x /opt/bin/neubot && /opt/bin/neubot -bq

6. Remove the ``_neubot`` user::

     userdel _neubot

7. Remove the ``_neubot`` group (not needed on some systems)::

     groupdel _neubot || true
