How-to install Neubot
=====================

This document provides information on how to install Neubot in the
following Operating Systems (OSes:)

* Windows XP, Vista, 7
* Debian, Ubuntu, LinuxMint
* MacOsX, OpenBSD

We also provide generic instructions to run and (optionally) install
Neubot that should fit most Unix-like OSes.

Windows XP, Vista, 7
^^^^^^^^^^^^^^^^^^^^

For the Windows operating systems we deploy a standard installer, that
copies our program in ``Program Files``, creates the proper links in the
Start menu, and adds an entry to "Add or Remove programs" in the Control
Panel.  You can download the latest installer at::

  http://www.neubot.org:8080/Neubot_Setup_0.2.2.exe

Debian, Ubuntu, LinuxMint
^^^^^^^^^^^^^^^^^^^^^^^^^

Of course you can install Neubot from its souces, but for these three
Linux distributions we also provide a package in ``.deb`` format.  The
package installation will also configure your system so that you get
automatic updates.

The package depends on Python 2.6, which is installed by default in
Ubuntu 9.10+ and LinuxMint 7+.  Debian users should upgrade to unstable
("squeeze") or testing ("sid") because Python 2.6 is not available
for 5.0 ("lenny.")

There are many ways to install the package, but the simplest one is to
download it and then double click on it (the system will ask you your
password because installing a package is a privileged operation.)

You can find the latest Neubot package here::

    http://www.neubot.org:8080/neubot-0.2.2-1_all.deb

An alternate procedure requires you to open the terminal, become root,
and type the following command::

    # dpkg -i neubot-0.2.2-1_all.deb

Optionally, you might also want to download the project public key, so
that your package manager does not complain that the Neubot repository
is not authenticated.  If you are interested, read-on the following
subsection.

Import Neubot public key
------------------------

1. Download Neubot public key::

    $ wget http://www.neubot.org:8080/PublicKey

2. Trust the public key::

    # apt-key add PublicKey

3. Get all the trusted keys fingerprints::

    # apt-key finger

4. Make sure that the output of step 3 contains the following entry::

    pub   2048D/F68D1AAD 2010-06-08 [expires: 2011-06-08]
        Key fingerprint = EE47 0CA5 B488 D2CC 3944  DE07 95F9 6A7A F68D 1AAD
    uid   Simone Basso <bassosimone@gmail.com>

MacOsX, OpenBSD
^^^^^^^^^^^^^^^

We do not provide Neubot packages for these two offsprings of the
BSD lineage.  So, please, refer to the "Running and installing Neubot
from sources" section for actual instructions.  Here we just collect
some hints that are specific of these two OSes, since we routinely test
Neubot on both.

MacOsX
------

Users not running MacOsX 10.6 ("Snow Leopard") must download and install
Python for Mac from::

  http://www.python.org/download/releases/2.6.5/

Once you have installed Python, you can follow the generic instructions
for running and installing from sources.

OpenBSD
-------

Python 2.6 is available since OpenBSD 4.5, but is not installed by
default.  Provided that the ``PKG_PATH`` environment variable is set,
you can install Python with the following command::

  # pkg_add -vi python

If there is more than one Python version available, you will be asked
which one you would like to install.  Choose version 2.6.

In addition to installing Python, you should apply the following patch
to be able to run Neubot at system startup::

  --- a/bin/unix/neubot
  +++ b/bin/unix/neubot
  @@ -1,4 +1,4 @@
  -#!/usr/bin/env python2.6
  +#!/usr/local/bin/python2.6

   # bin/unix/neubot
   # Copyright (c) 2010 NEXA Center for Internet & Society

Running and installing Neubot from sources
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This section describes the procedure to run and, optionally, install
Neubot from the sources archive.  It should work on most Unix-like
operating systems.

Dependencies
------------

To run Neubot you need to have Python 2.6 installed.  In other words,
the command::

  python2.6 -V

Should return ``Python 2.6.X`` where ``X`` might vary depending on
your OS.  If that is not the case, you should take the proper steps in
order to install Python 2.6 on your distro.

We known that Python 2.6 is available for the following Unix-like
operating systems

* LinuxMint 7+
* MacOsX 10.6 "Snow Leopard"
* OpenBSD 4.7
* Ubuntu 9.10, 10.04

Run Neubot in-place
-------------------

To run Neubot in-place from the sources directory, type::

  ./bin/unix/neubot -I.

The magic lies in the ``-I.`` command line switch, that instructs the
startup procedure to search the rest of the program in the current
working directory (rather than in ``/usr/local/share``.)

Invoked this way, neubot will run in automatic mode, e.g. it connects
periodically to the master server retrieving the list of tests to be
performed and checking for updates.  You can interrupt it with ``Ctrl-C``
at any time.

To find out more options, try the following commands::

  ./bin/unix/neubot -I. --help
  ./bin/unix/neubot -I. help

[The ``help`` command is actually disabled in this release, but we
will re-enabled it into the next one.]

Install Neubot
--------------

The vanilla command to install Neubot, to be run as root, is::

  make install

It will install the neubot command in ``$PREFIX/bin`` and the rest of
the program in ``$PREFIX/share/neubot``, where, by default, ``PREFIX``
is ``/usr/local``.  By modifying ``PREFIX``, you can adjust the actual
location where Neubot is installed.  So, for example, to install below
``/opt``, become root and then type something like::

  make install PREFIX=/opt

Run Neubot automatically
------------------------

You need to create the ``_neubot`` user and group, because Neubot will
refuse to run as the ``root`` user.  To do that, as ``root``, type::

  groupadd _neubot
  useradd -d/ -g_neubot -s/bin/false _neubot

Now (assuming that you have installed Neubot below ``/opt``, as shown
in the above example) add near the bottom of ``/etc/rc.local`` the
following line::

  test -x /opt/bin/neubot && /opt/bin/neubot -b

Finally, if you don't want to reboot your machine, start Neubot immediatly
with::

  /opt/bin/neubot -b

Invoked that way, it will detach from the shell, running in background,
logging messages through ``syslog(8)``.  The actual log file employed
depends on your operating system, however, you can get a list of all the
files containing the ``neubot`` word running the following command as
``root``::

  grep neubot /var/log/*|awk -F: '{print $1}'|sort|uniq

Once you have guessed the name of the relevant file, you can ``grep``
to read just the Neubot-related messages, e.g. with Ubuntu::

  grep neubot /var/log/syslog|less

Uninstall Neubot
----------------

Assuming that you have installed Neubot below ``/opt``, as show by the
above example, you can take the following steps in order to uninstall it:

1. Become ``root``.

2. Kill all the running Neubots::

     kill `ps aux|grep neubot|grep -v grep|awk '{print $2}'`

3. Remove the neubot command::

     rm /opt/bin/neubot

4. Remove the rest of the program::

     rm -rf /opt/share/neubot/

In addition, if you amended your system to invoke Neubot at startup,
perform the following steps:

5. Remove the following line from ``/etc/rc.local``::

     test -x /opt/bin/neubot && /opt/bin/neubot -b

6. Remove the ``_neubot`` user::

     userdel _neubot

7. Remove the ``_neubot`` group (not needed on some systems)::

     groupdel _neubot || true
